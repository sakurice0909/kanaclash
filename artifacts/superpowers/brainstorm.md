# Superpowers Brainstorm

## Task
**これを無料のサーバにアップロードしたい。パスプレイ方式ではなく、各プレイヤーがそれぞれスマホを操作してプレイしたい。**

## Goal
「あいうえバトル」ゲームを無料のホスティングサービスにデプロイし、複数のプレイヤーがそれぞれ自分のスマートフォンから同時にプレイできるようにする。

## Constraints
- **コスト**: 完全無料のホスティングサービスを使用
- **技術スタック**: React + TypeScript + Vite (既存)
- **ゲームルール**: 現在の「あいうえバトル」ルールを維持
- **リアルタイム性**: プレイヤー間でゲーム状態を同期する必要がある
- **モバイル対応**: スマホでの操作に最適化

## Known context
- **現在の構成**: React 19 + Zustand (クライアントサイド状態管理) + Vite
- **ゲームフロー**: SETUP → INPUT → BATTLE → GAMEOVER
- **現在の問題点**: 全ての状態がクライアント側のZustandで管理されており、複数デバイス間での状態共有ができない
- **ビルド出力**: Viteで静的ファイル（dist/）を生成

## Risks
1. **リアルタイム同期の複雑さ**: WebSocket/リアルタイムDBの実装が必要で、既存コードの大幅な変更が発生
2. **無料サービスの制限**: バックエンド付きの場合、コールドスタート問題やリクエスト制限あり
3. **セキュリティ**: 単語の秘匿性を保証するためにサーバーサイドでの検証が必要
4. **開発工数**: マルチプレイヤー対応は単純なデプロイより大幅に工数がかかる
5. **スケーラビリティ**: 無料枠の制限で同時プレイ可能人数に制限

## Options (2–4)

### Option 1: 静的デプロイ + ルーム共有URL方式（シンプル）
- **ホスティング**: Vercel / Netlify / GitHub Pages（無料）
- **同期方法**: WebRTC (P2P) または Supabase Realtime（無料枠）
- **実装**: ルームIDをURL共有、1人がホストとなりP2P接続
- **長所**: バックエンドサーバー不要、無料枠で十分
- **短所**: NAT越えの問題、ホスト離脱でゲーム終了

### Option 2: BaaS活用（Firebase/Supabase）
- **ホスティング**: Vercel + Firebase Realtime DB または Supabase
- **同期方法**: Firestore/Supabase のリアルタイム同期
- **実装**: ルームをDB上に作成、全プレイヤーが購読
- **長所**: 信頼性が高い、実装がシンプル、無料枠で十分
- **短所**: 単語がDB上に保存されるためセキュリティ考慮が必要

### Option 3: フルサーバーレス（Cloudflare Workers + Durable Objects）
- **ホスティング**: Cloudflare Pages + Workers
- **同期方法**: Durable Objects でステートフルなルームを管理
- **実装**: ゲームロジックをサーバーサイドに移行
- **長所**: エッジでの低レイテンシ、無料枠あり
- **短所**: 実装が複雑、学習コストが高い

### Option 4: PartyKit / Liveblocks
- **ホスティング**: Vercel + PartyKit または Liveblocks
- **同期方法**: マルチプレイヤー専用のリアルタイムインフラ
- **実装**: 専用SDKを使用してルーム管理
- **長所**: マルチプレイヤー用に最適化されている
- **短所**: 無料枠の制限がある、依存度が高い

## Recommendation

**Option 2: Supabase Realtime + Vercel を推奨**

理由:
1. **無料枠が十分**: Supabase Free Tier（500MB DB, 2GB帯域/月）で小規模ゲームに十分
2. **実装がシンプル**: Supabase Realtime の `subscribe()` でリアルタイム同期が容易
3. **Vercelとの相性**: そのままVercelにデプロイ可能
4. **段階的移行**: 既存のZustandストアを活かしつつ、同期レイヤーを追加可能
5. **セキュリティ**: Row Level Security (RLS) でルームごとのアクセス制御可能

**実装の流れ:**
1. まず静的サイトとしてVercelにデプロイ（ベースライン）
2. Supabaseプロジェクト作成、ルーム/プレイヤーテーブル設計
3. ルーム作成・参加フローをUIに追加
4. ゲーム状態の同期ロジックを実装
5. 単語入力のセキュリティ対応（サーバーサイドバリデーション）

## Acceptance criteria
- [ ] ゲームが無料のホスティングサービス上で動作する
- [ ] QRコード/URLを共有して複数プレイヤーがルームに参加できる
- [ ] 各プレイヤーが自分のスマートフォンから操作できる
- [ ] ゲーム状態がリアルタイムで全プレイヤーに反映される
- [ ] 他プレイヤーの単語が見えない（セキュリティ）
- [ ] スマホでの操作が快適（レスポンシブ対応）
- [ ] ゲームが安定して動作する（エラーハンドリング）
